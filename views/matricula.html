<!doctype html>
<html lang="es">

<head>
  <title>Matriculados</title>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS v5.2.1 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">

</head>

<body>
  
  <div class="container mt-5">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h3 class="text-center">Imformación de Matriculas</h3>
        </div>
        <div class="card-body">
          <div class="col-12">
            <div class="row">
              <div class="mb-3 col-8">
                <label for="buscarmatricula" class="form-label">Buscar Matricula:</label>
                <input type="text" class="form-control" id="buscarmatricula" placeholder="Escriba aqui">
              </div>
               <div class="col-4">
                <div class="d-grid gap-2 col-6 mx-auto">
                  <button class="btn btn-primary" type="button">Buscar</button>
                  <button class="btn btn-secondary" type="button">Reiniciar</button>
                </div>
               </div>
            </div>
          </div>
        </div>
      </div>
      <div class="mb-3 mt-3">
        <!-- Modal trigger button -->
        <button class="btn btn-success" type="button" data-bs-toggle="modal" data-bs-target="#modalId">Registrar matricula</button>
        <!-- Modal Body -->
        <!-- if you want to close by clicking outside the modal, delete the last endpoint:data-bs-backdrop and data-bs-keyboard -->
        <div class="modal fade" id="modalId" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
          <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="modalTitleId">Registrar Matricula</h5>
                  <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
              </div>
              <div class="modal-body">
                <form action="" id="registro-matricula">
                  <div class="row">
                    <div class="mb-3 col-lg-6">
                      <label for="alumno" class="form-label">Alumno:</label>
                      <input type="text" class="form-control" id="alumno" placeholder="Escriba...">
                    </div>
                    <div class="mb-3 col-lg-6">
                      <label for="fechanac" class="form-label">Fecha nacimiento:</label>
                      <input type="date" class="form-control" id="fechanac" placeholder="Escriba...">
                    </div>
                    <div class="mb-3 col-lg-6">
                      <label for="numdoc" class="form-label">N° Documento:</label>
                      <input type="text" class="form-control" id="numdoc" placeholder="Escriba...">
                    </div>
                    <div class="mb-3 col-lg-6">
                      <label for="docentes" class="form-label">Docentes:</label>
                      <select class="form-select" aria-label="Default select example" id="docentes">
                        <option selected>Seleccione</option>
                        <!-- <option value=""></option> -->
                      </select>
                    </div>
                    <div class="mb-3 col-lg-6">
                      <label for="carreras" class="form-label">Carreras:</label>
                      <select class="form-select" aria-label="Default select example" id="carreras">
                        <option selected>Seleccione</option>
                        <!-- <option value=""></option> -->
                      </select>
                    </div>
                    <div class="mb-3 col-lg-6">
                      <label for="periodo" class="form-label">Periodo:</label>
                      <input type="text" class="form-control" id="periodo" placeholder="Escriba...">
                    </div>
                    <div class="mb-3 col-lg-6">
                      <label for="semestre" class="form-label">Semestre:</label>
                      <input type="text" class="form-control" id="semestre" placeholder="Escriba...">
                    </div>
                    <div class="mb-3 col-lg-6">
                      <label for="fechainicio" class="form-label">Fecha inicio:</label>
                      <input type="date" class="form-control" id="fechainicio" placeholder="Escriba...">
                    </div>
                    <div class="mb-3 col-lg-6">
                      <label for="fechafin" class="form-label">Fecha final:</label>
                      <input type="date" class="form-control" id="fechafinal" placeholder="Escriba...">
                    </div>
                    <div class="mb-3 col-lg-6">
                      <label for="pago" class="form-label">Pago:</label>
                      <input type="text" class="form-control" id="pago" placeholder="S/00.00">
                    </div>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="registrarmatricula">Guardar</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
              </div>
            </div>
          </div>
        </div>
        
        
        <!-- Optional: Place to the bottom of scripts -->
        <!-- <script>
          const myModal = new bootstrap.Modal(document.getElementById('modalId'), options)
        
        </script> -->
      </div>
      <div class="row">
        <div class="table-responsive">
          <table class="table table-striped" id="tabla-matricula">
            <thead>
              <tr>
                <th>ID</th>
                <th>Matriculado</th>
                <!-- <th>N° Documento</th> -->
                <th>Docente</th>
                <th>Carrera</th>
                <th>Periodo</th>
                <th>Semestre</th>
                <th>Fecha Inicio</th>
                <th>Fecha Final</th>
                <th>Pago</th>
              </tr>
            </thead>
            <tbody>
              
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () =>{
      const tabla = document.querySelector("#tabla-matricula");
      const cuerpoTabla = document.querySelector("tbody");
      const lista= document.querySelector("#docentes");
      const carrera = document.querySelector("#carreras");
      const btnguardar = document.querySelector("#registrarmatricula");
      const modal = new bootstrap.Modal(document.querySelector("#modalId"));

      function ObtenerDatos(){
        const parametros = new URLSearchParams();
        parametros.append("operacion","listar");
        // parametros.append("id_matricula",parseInt(tabla.value));
        fetch('../controllers/matricula.controller.php',{
          method: 'POST',
          body: parametros
        })
        .then(respuesta => respuesta.json())
        .then(datos => {
          cuerpoTabla.innerHTML=``;
          datos.forEach(element => {
            const fila = `
            <tr>
              <td>${element.idmatricula}</td>
              <td>${element.alumno}</td>
              <td>${element.docente}</td>
              <td>${element.nombrecarrera}</td>
              <td>${element.periodo}</td>
              <td>${element.semestre}</td>
              <td>${element.fechainicio}</td>
              <td>${element.fechafinal}</td>
              <td>${element.pago}</td>
            `;
            cuerpoTabla.innerHTML += fila;
          });
        })
        .catch(error => {
          cuerpoTabla.innerHTML =``;
          alert('No encontramos datos')
        });
      }

      function ObtenerCarreras(){
        const parametros = new URLSearchParams();
        parametros.append("operacion","listar");
        
        fetch('../controllers/carrera.controller.php',{
          method: 'POST',
          body: parametros
        })
        .then(respuesta => respuesta.json())
        .then(datos =>{
          datos.forEach(element => {
            const optionTag = document.createElement("option");
            optionTag.value = element[0];
            optionTag.text = element[2]
            carrera.appendChild(optionTag);
          }); 
        });
      }

      function Obtenerdocentes(){
        const parametros = new URLSearchParams();
        parametros.append("operacion","listar");
        
        fetch('../controllers/docente.controller.php',{
          method: 'POST',
          body: parametros
        })
        .then(respuesta => respuesta.json())
        .then(datos =>{
          datos.forEach(element => {
            const optionTag = document.createElement("option");
            optionTag.value = element[0];
            optionTag.text = element[1];
            lista.appendChild(optionTag);
          }); 
        });
      }

      

      function registrarMatriculas(){
        if(confirm("¿Está seguro de registrar?")){
          const parametros = new URLSearchParams();
          parametros.append("operacion","registrar");

          //Enviar datos al formulario
          parametros.append("alumno",document.querySelector("#alumno").value);
          parametros.append("fechanac",document.querySelector("#fechanac").value);
          parametros.append("numdoc",document.querySelector("#numdoc").value);
          parametros.append("iddocente",document.querySelector("#docentes").value);
          parametros.append("idcarrera",document.querySelector("#carreras").value);
          parametros.append("periodo",document.querySelector("#periodo").value);
          parametros.append("semestre",document.querySelector("#semestre").value);
          parametros.append("fechainicio",document.querySelector("#fechainicio").value);
          parametros.append("fechafinal",document.querySelector("#fechafinal").value);
          parametros.append("pago",document.querySelector("#pago").value);

          fetch("../controllers/matricula.controller.php",{
            method: 'POST',
            body: parametros
          })
            .then(response => response.json())
            .then(datos =>{
                if(datos.status){
                  document.querySelector("#registro-matricula").reset();
                  document.querySelector("#alumno").focus();
                }else{
                  alert(datos.message);
                }
            });
        }
      }

        //Eventos
        btnguardar.addEventListener("click", registrarMatriculas);
        ObtenerDatos();
        Obtenerdocentes();
        ObtenerCarreras();
    })
  </script>


  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
    integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous">
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js"
    integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz" crossorigin="anonymous">
  </script>
</body>

</html>